name: Build Windows Application

on:
  push:
    branches: [main]
    tags:
      - "v*"
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.9"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pyinstaller

      - name: Build EXE
        run: |
          pyinstaller --clean --noconfirm build-windows.spec

      - name: Create Release Package
        run: |
          mkdir release
          copy dist\NaverBlog.exe release\
          copy ì‚¬ìš©ì„¤ëª…ì„œ.txt release\
          copy README.md release\

      - name: Create ZIP Archive
        run: |
          powershell Compress-Archive -Path release\* -DestinationPath NaverBlog-Windows.zip

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: NaverBlog-Windows
          path: NaverBlog-Windows.zip
          retention-days: 30

      - name: Create Release (if tag)
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v2
        with:
          files: NaverBlog-Windows.zip
          body: |
            ## ğŸš€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìë™ í¬ìŠ¤íŒ… í”„ë¡œê·¸ë¨

            ### ğŸ“¦ ë‹¤ìš´ë¡œë“œ íŒŒì¼
            - **NaverBlog-Windows.zip** - Windowsìš© ì‹¤í–‰ íŒŒì¼ + ì‚¬ìš© ì„¤ëª…ì„œ

            ### ğŸ“‹ í¬í•¨ ë‚´ìš©
            - âœ… NaverBlog.exe - ë©”ì¸ í”„ë¡œê·¸ë¨
            - âœ… ì‚¬ìš©ì„¤ëª…ì„œ.txt - ìƒì„¸í•œ ì‚¬ìš© ê°€ì´ë“œ
            - âœ… README.md - í”„ë¡œì íŠ¸ ì •ë³´

            ### ğŸš€ ë¹ ë¥¸ ì‹œì‘
            1. NaverBlog-Windows.zip ë‹¤ìš´ë¡œë“œ
            2. ì••ì¶• í•´ì œ
            3. ì‚¬ìš©ì„¤ëª…ì„œ.txt íŒŒì¼ì„ ë¨¼ì € ì½ì–´ë³´ì„¸ìš”
            4. NaverBlog.exe ì‹¤í–‰

            ### âš ï¸ ì£¼ì˜ì‚¬í•­
            - Windows Defender ê²½ê³ ê°€ ë‚˜ì˜¤ë©´ "ì¶”ê°€ ì •ë³´" â†’ "ì‹¤í–‰" í´ë¦­
            - ë„¤ì´ë²„ ì´ìš©ì•½ê´€ì„ ì¤€ìˆ˜í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”
            - ê³¼ë„í•œ ìë™í™”ëŠ” ê³„ì • ì œì¬ì˜ ì›ì¸ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤

            ### ğŸ”§ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
            - Windows 7/10/11 (64ë¹„íŠ¸)
            - ìµœì†Œ 4GB RAM
            - ì•ˆì •ì ì¸ ì¸í„°ë„· ì—°ê²°

            ---
            **Happy Blogging! ğŸ‰**
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Auto Release (if main branch push)
        if: github.ref == 'refs/heads/main' && github.event_name == 'push'
        uses: softprops/action-gh-release@v2
        with:
          tag_name: auto-v${{ github.run_number }}
          name: ìë™ ë¹Œë“œ v${{ github.run_number }}
          files: NaverBlog-Windows.zip
          body: |
            ## ğŸ¤– ìë™ ë¹Œë“œ ì™„ë£Œ

            ### ğŸ“¦ ë‹¤ìš´ë¡œë“œ
            - **NaverBlog-Windows.zip** - Windowsìš© ì‹¤í–‰ íŒŒì¼ + ì‚¬ìš© ì„¤ëª…ì„œ

            ### ğŸ“‹ í¬í•¨ ë‚´ìš©
            - NaverBlog.exe
            - ì‚¬ìš©ì„¤ëª…ì„œ.txt
            - README.md

            ### ìµœì í™” ì‚¬í•­
            - ë¶ˆí•„ìš”í•œ íŒŒì¼ ë° ì½”ë“œ ì œê±°
            - Windows ì „ìš© ìµœì í™”
            - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
            - ë¹Œë“œ í¬ê¸° ìµœì í™”

            ### ì‚¬ìš©ë²•
            1. zip íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° ì••ì¶• í•´ì œ
            2. ì‚¬ìš©ì„¤ëª…ì„œ.txt ì½ê¸°
            3. NaverBlog.exe ì‹¤í–‰
            4. ê³„ì • ì¶”ê°€ í›„ ë¸Œë¼ìš°ì € ì—´ê¸°
            5. ì •ë¦¬ ë²„íŠ¼(ğŸ”§)ìœ¼ë¡œ ë¸Œë¼ìš°ì € ì´ˆê¸°í™” ê°€ëŠ¥
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
