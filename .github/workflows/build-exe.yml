name: Build Windows Executable

on:
  push:
    tags:
      - "v*.*.*" # v1.0.0, v2.1.3 등의 태그가 푸시될 때
  workflow_dispatch: # 수동으로도 실행 가능

env:
  APP_NAME: 네이버블로그자동포스팅
  PYTHON_VERSION: "3.9"

jobs:
  build:
    name: Build Windows .exe
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install PyQt5==5.15.7
          pip install selenium==4.11.2
          pip install openai==1.3.5
          pip install requests==2.31.0
          pip install pytz==2023.3
          pip install pyinstaller==5.13.2

      - name: Build executable
        run: |
          echo "🚀 PyInstaller로 .exe 파일 생성 중..."
          pyinstaller main.spec

          echo "📋 빌드 결과 확인:"
          dir dist\

          echo "✅ .exe 파일 생성 완료!"
          if (Test-Path "dist\네이버블로그자동포스팅.exe") {
            echo "✅ .exe 파일이 성공적으로 생성되었습니다!"
            dir "dist\네이버블로그자동포스팅.exe"
          } else {
            echo "❌ .exe 파일 생성 실패!"
            exit 1
          }

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: naver-blog-automation
          path: dist/네이버블로그자동포스팅.exe

      - name: Build Success Notification
        run: |
          echo "🎉 빌드가 성공적으로 완료되었습니다!"
          echo "📦 .exe 파일이 아티팩트에 업로드되었습니다."
          echo ""
          echo "📥 다운로드 방법:"
          echo "1. GitHub Actions 페이지에서 이 빌드 클릭"
          echo "2. 'Artifacts' 섹션에서 'naver-blog-automation' 다운로드"
          echo "3. 압축 해제하여 '네이버블로그자동포스팅.exe' 실행"
          echo ""
          echo "🔗 직접 링크: https://github.com/${{ github.repository }}/actions"
          echo ""
          echo "✨ 주요 기능:"
          echo "- 다중 네이버 계정 지원"
          echo "- AI 콘텐츠 생성 (OpenAI 연동)"
          echo "- 정확한 예약 발행"
          echo "- 자동 태그 관리"
          echo "- 발행된 게시물 URL 자동 수집"
          echo ""
          echo "💻 시스템 요구사항: Windows 7/10/11 (64비트)"
          echo "⚠️ 주의: 첫 실행 시 Windows Defender 경고 정상"
